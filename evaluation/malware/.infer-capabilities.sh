#!/bin/sh

package="$1"
version="$2"

cbom="capabilities-inferred.json"
sbom='./sbom.json'
if [ -f "sbom-corrected.json" ]; then
	sbom='./sbom-corrected.json'
fi

../.setup.sh "$package" "$version"

node ../.cli/src/cli.js \
	--strategy 'exit' \
	--sbom "$sbom" \
	--build-only --cbom-output "$cbom" \
	-- \
	'index.js' \
	1>/dev/null 2>/dev/null

jq ".["'"'"$package@$version"'"'"]" <"$cbom"
